# اختبارات الدخان (End-to-End)

توثيق لخطوات التحقق لكل دور. يجب تنفيذها على بيئة مرتبطة بـ Supabase (محلية أو سحابية) ثم رفع السجلات إلى:
`\\wsl.localhost\Ubuntu-24.04\home\zidan\dev\aelmamclinic\.ci\logs\2025-11-16_19-23`.

> **ملاحظة:** البيئة داخل CLI الحالي لا تتضمّن نسخة Supabase فعّالة، لذا لم تُشغّل الاختبارات فعليًا. استخدم الجدول أدناه كقائمة إجراءات ودوّن النتيجة عند التنفيذ الفعلي.

## ملخص الحالات

| الدور | الخطوات الحرجة | النتيجة الحالية | ملاحظات التنفيذ |
|-------|----------------|-----------------|-----------------|
| Super Admin | 1) تسجيل الدخول بحساب `admin@elmam.com`. 2) التحقق من `my_feature_permissions`. 3) فتح شاشات المخزون والإحصائيات. 4) إرسال رسالة ومرفق. 5) إنشاء مجموعة ودعوة مالك. 6) قبول/رفض الدعوات. | غير منفذ (البيئة غير متصلة) | نفّذ الأوامر من التطبيق بعد تشغيل Supabase، وسجّل السجل في مسار CI. |
| Owner | 1) تسجيل الدخول. 2) تأكيد استلام الأذونات (لا توجد خصائص مفقودة). 3) CRUD للمخزون. 4) محادثة + مرفقات. 5) قبول دعوة من Super Admin. | غير منفذ | استخدم حساب مالك حقيقي، ودوّن أي أخطاء في المرفقات/dart logs. |
| Employee | 1) تسجيل الدخول مع حساب موظف. 2) إرسال رسالة/مرفق. 3) استلام دعوة مجموعة وقبولها. 4) محاولة إدارة الصلاحيات (يجب أن تُمنع). | غير منفذ | احرص على ملاحظة أخطاء الصلاحيات (يجب أن تكون مفهومة للمستخدم). |
| Disabled account | 1) تعطيل حساب موظف عبر Supabase. 2) محاولة تسجيل الدخول وفتح الشاشات. 3) التأكد من أن AuthProvider يُظهر رسالة تعطيل ويوقف المزامنة. | غير منفذ | راقب سجلات `_authDiagWarn` للتحقق من تحذيرات RPC. |

## تسلسل التنفيذ المقترح

1. **إعداد البيئة**  
   - شغّل `supabase start` أو تأكد من اتصال التطبيق بسيرفر الإنتاج/المرحلة.  
   - حدّث قيم `SUPABASE_URL` و `SUPABASE_ANON_KEY` في ملف الإعداد المحلي.

2. **تشغيل التطبيق**  
   - `flutter pub get`  
   - `flutter run -d <device>` (أو `flutter build apk` للتوزيع الداخلي).

3. **تنفيذ كل سيناريو**  
   - اتبع الجدول أعلاه لكل دور.  
   - التقط لقطات شاشة/سجلات (خاصة عند حدوث فشل).  
   - خزن النتائج في مجلد السجلات الموحّد مع تسمية واضحة (`super-admin-smoke.log`…).

4. **التبليغ عن الإخفاقات**  
   - في حال ظهور رسالة خطأ جديدة، أرفق صورة/نص الخطأ في السجل.  
   - استخدم `lastError` من `AuthProvider` / `ChatProvider` للتأكد من أن التليمترية تعمل (يجب أن تشاهد التحذيرات في وحدة التحكم).

5. **اعتماد النتائج**  
   - بعد إنهاء السيناريوهات، حدّث هذا المستند أو ملف السجلات بتاريخ التنفيذ، ثم شاركه مع الفريق.

باتّباع هذا الدليل يمكن التأكد من أن كل دور يعمل بسلاسة وأن التحذيرات الجديدة تساعد على اكتشاف أي نقص في الخلفية بسرعة.*** End Patch```} to=functions.apply_patch ***!
